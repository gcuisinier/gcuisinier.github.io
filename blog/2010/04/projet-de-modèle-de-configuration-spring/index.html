<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.73.0" />

    
    
    

<title>Projet de modèle de configuration Spring • Gildas Cuisinier</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Projet de modèle de configuration Spring"/>
<meta name="twitter:description" content="Présentation d&#39;un projet qui permet d&#39;avoir des modèles de configuration XML pour Spring Framework"/>

<meta property="og:title" content="Projet de modèle de configuration Spring" />
<meta property="og:description" content="Présentation d&#39;un projet qui permet d&#39;avoir des modèles de configuration XML pour Spring Framework" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.gcuisinier.net/blog/2010/04/projet-de-mod%C3%A8le-de-configuration-spring/" />
<meta property="article:published_time" content="2010-04-08T08:00:00+01:00" />
<meta property="article:modified_time" content="2010-04-08T08:00:00+01:00" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.cf524d34bc8fcf020dc8dee72f6db57b7a6da47fe54e852cb78e1ed1a29d1540.css" integrity="sha256-z1JNNLyPzwINyN7nL221e3ptpH/lToUst44e0aKdFUA=">


<link rel="stylesheet" href="/scss/print.5aa4005c7565ec5b66c62cd79012c5cad1081f3332793145a8d3861a26391697.css" integrity="sha256-WqQAXHVl7FtmxizXkBLFytEIHzMyeTFFqNOGGiY5Fpc=" media="print">




<link rel="stylesheet" href="/scss/tocbot.5ef07cebc3c477b54270456f149ee02922479bb7555fd344b2c69f953b0e7e5e.css" integrity="sha256-XvB868PEd7VCcEVvFJ7gKSJHm7dVX9NEssaflTsOfl4=">




    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    
<link href="/css-static/hover.css" rel="stylesheet">

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container  vertical-center">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.gcuisinier.net/">Gildas Cuisinier</a>
      </span>
      <small class="text-center center-block">&lt;dev&gt;SomeWhere&lt;ops&gt;</small>

      
        
        
        
        <div class="author-image hvr-rotate">
          <img src="https://www.gcuisinier.net/img/gcuisinier.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Gildas Cuisinier</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/about/" class="hvr-push">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/posts/" class="hvr-push">
						<span>Blog</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/portfolio/" class="hvr-push">
						<span>Projects</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/gcuisinier" rel="me"><i class="fab fa-twitter fa-lg hvr-buzz-out hvr-buzz-out " aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/gcuisinier" rel="me"><i class="fab fa-github fa-lg hvr-buzz-out hvr-buzz-out" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	<a href="https://keybase.io/gcuisinier" rel="me"><i class="fab fa-keybase fa-lg hvr-buzz-out" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://about.me/gcuisinier"><i class="fas fa-address-card fa-lg hvr-buzz-out" aria-hidden="true"></i></a>
	
	
	
	<a href="mailto:contact%20[at]%20gcuisinier.net" rel="me"><i class="fas fa-at fa-lg hvr-buzz-out" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    

<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Projet de modèle de configuration Spring</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Apr 08, 2010
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/opensource">OPENSOURCE</a>
              •
          
              <a class="badge badge-category" href="/categories/spring">SPRING</a>
              
          
      
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 2 min read
</div>


  </header>
  
  
  
    <div class="toc-wrapper">
      <input type="checkbox" id="tocToggle">
      <label for="tocToggle">Table of Content</label>
      
        <div class="toc" id="TableOfContents"></div>
      
    </div>
  
  
  <div class="post">
    <h2 id="problème">Problème</h2>
<p>Sur certains projets, j&rsquo;ai eu l&rsquo;occasion de voir des fichiers de configuration Spring de ce type :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;import</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;monitoring-environnement1.xml&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;import</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;monitoring-environnement2.xml&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;import</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;monitoring-environnement3.xml&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><p>Et bien évidemment, chacun des fichiers de configurations importés était tous semblables, avec comme seule différence les noms de beans Spring ou des valeurs de propriétés.
Si demain, un nouvel environnement devait être ajouté, je vous le donne dans le mille : un copier / coller, un s/environnement1/nouvel-environnement/g  !</p>
<p>Même si cela fonctionne bien, ce n&rsquo;est pas la solution la plus propre : Si le système de monitoring devait être modifié, il faudrait éditer X fichiers, avec le risque d&rsquo;oublier un fichier, ou un valeur&hellip;</p>
<h1 id="solution-1--créer-un-namepace-dédié-au-monitoring">#Solution 1 : Créer un namepace dédié au monitoring</h1>
<p>Une première solution possible serait de remplacer ces imports par un namespace dédié au monitoring. Il suffirait dès lors d&rsquo;utiliser une configuration de ce type :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;monitoring:environnement</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;environnement1&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;monitoring:environnement</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;environnement2&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><p>C&rsquo;est déjà beaucoup plus propre, mais cette solution n&rsquo;est pas des plus pratiques :</p>
<ul>
<li>La configuration &ldquo;générique&rdquo; sera réalisée via une API spécifique à Spring, que peu de développeurs connaissent ( BeanDefinitionParser, ParserContext, BeanDefinitionRegistry, ..), ce qui rends toute modification assez complexe</li>
<li>Le namespace sera dédié au monitoring ! Si le domaine des fichiers était tout autre, il faudrait développer un nouveau namespace.</li>
<li>Le namespace va cacher aux utilisateurs les beans réellement instanciés</li>
</ul>
<p>Bref, c&rsquo;est déjà mieux mais pas encore suffisamment claire et simple.</p>
<h1 id="solution-2--créer-un-namepace-dimportation-de-modèles-de-configuration">#Solution 2 : Créer un namepace d&rsquo;importation de modèles de configuration</h1>
<p>Afin de répondre à ces problématique, il est possible de créer un namespace beaucoup plus générique. Celui qui permettrait d&rsquo;importer une configuration classique (un modèle), mais en remplaçant certaines variables par des valeurs.</p>
<p>Le modèle serait un fichier de configuration Spring tout à fait compréhensible par des habitués de Spring, mais dans laquelle des variables seraient définies :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;beans</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span style="color:#f92672">&gt;</span> 

    <span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;scheduledTimeTask.${environnement}&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.springframework.scheduling.timer.ScheduledTimerTask&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;timerTask&#34;</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;monitoringTask.${environnement}&#34;</span><span style="color:#f92672">/&gt;</span> 

        <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;delay&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;1000&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;period&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;1000&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/bean&gt;</span>
    <span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;timer.${environnement}&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.springframework.scheduling.timer.TimerFactoryBean&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;scheduledTimerTasks&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;list&gt;</span>
                <span style="color:#f92672">&lt;ref</span> <span style="color:#a6e22e">bean=</span><span style="color:#e6db74">&#34;scheduledTimeTask.${environnement}&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;/list&gt;</span>
        <span style="color:#f92672">&lt;/property&gt;</span>
    <span style="color:#f92672">&lt;/bean&gt;</span>
    <span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;monitoringTask.${environnement}&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;be.hikage.springtemplate.MonitoringTimerTask&#34;</span><span style="color:#f92672">&gt;</span>
           <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;url&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${${environnement}.url}&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/bean&gt;</span> 

<span style="color:#f92672">&lt;/beans&gt;</span>
</code></pre></div><p>Ici, <!-- raw HTML omitted -->${environnement}<!-- raw HTML omitted -->, est une variable qui sera définie lors de l&rsquo;importation du modèle :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">	    <span style="color:#f92672">&lt;hikage:import-template</span> <span style="color:#a6e22e">location=</span><span style="color:#e6db74">&#34;template-monitoring.xml&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;hikage:variable</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;environnement&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;environnement1&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/hikage:import-template&gt;</span>
</code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>Cette solution possède donc plusieurs avantages :</p>
<!-- raw HTML omitted -->
<h2 id="informations">Informations</h2>
<p>Ce projet est disponible sous licence Apache 2 sur <a href="http://code.google.com/p/spring-import-template">http://code.google.com/p/spring-import-template/</a></p>
  </div>
  

<div class="navigation navigation-single">
    
    
    <a href="/blog/2010/04/cr%C3%A9er-un-namespace-spring/" class="navigation-next">
      <span class="navigation-tittle">Créer un namespace Spring</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <div id="disqus_thread"></div>
<script type="text/javascript">
    

    (function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'gcuisinier-github';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by
  <span class="logo-disqus">Disqus</span>
</a>

    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    



<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.js"></script>
<script type="text/javascript">
  if (tocbot) {
    tocbot.init({
      
      tocSelector: '.toc',
      
      contentSelector: '.post',
      
      headingSelector: 'h2, h3, h4',
      collapseDepth: 4
    });
  }
</script>



    



    </body>
</html>
