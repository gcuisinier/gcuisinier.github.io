<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.53" />

    
    
    

<title>Présentation de xdt4j • Gildas Cuisinier</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Présentation de xdt4j"/>
<meta name="twitter:description" content="Introduction

Chez mon client, nous avons eu un besoin particulier : celui de pouvoir étendre des archetypes Maven.
Autrement dit, pouvoir créer un archetype qui se baserait sur un autre, et qui apporterait uniquement le delta de différence.

Pour certain fichier, nous n&rsquo;avons pas eu le choix, nous avons été obliger de fournir une nouvelle version qui remplacerait la version initiale, par exemple les fichiers binaires tels que les images.

Par contre, pour le fichiers XML, et en particulier les fichiers pom.xml ou encore le fichier archetype-metadata.xml, c&rsquo;était plus problématique. En effet, en cas de modification de l&rsquo;un des ces fichiers dans l&rsquo;archetype de base, nous aurions été obligé de copier ceux-ci, et ré-introduire les delta à la main&hellip; ce qui ne serait pas très productifs.

Partant du fait que ces fichiers sont du XML, il me semblait plus logique de partir du fichier de base et de ne décrire que les transformations à lui apporter. Quand on parle de transformation en XML, on pense tout de suite à XSLT.
Mais il faut avouer que s&rsquo;il est très puissant, il n&rsquo;est pas forcément le plus simple à appréhender.

J&rsquo;ai donc cherché des alternatives plus simples. En discutant avec un consultant .Net, celui-ci m&rsquo;a présenté le système qui est utilisé par Microsoft pour gérer les fichiers de configuration de IIS : XML Document Transform.
J&rsquo;ai tout de suite trouvé cette solution élégante pour répondre à notre problème.

Par chance, quelqu&rsquo;un a eu la bonne idée de faire une première implémentation OpenSource ( en se basant sur tout les exemples qu&rsquo;il à trouvé dans la documentation et sur internet.
Son implémentation se basait sur des spécificités .Net, donc impossible de le porter tel quel en Java.
Cependant, son jeu de test était assez complet.

Grâce à celui-ci tests, j&rsquo;ai pu développer en TDD une implémentation en Java : xdt4j."/>

<meta property="og:title" content="Présentation de xdt4j" />
<meta property="og:description" content="Introduction

Chez mon client, nous avons eu un besoin particulier : celui de pouvoir étendre des archetypes Maven.
Autrement dit, pouvoir créer un archetype qui se baserait sur un autre, et qui apporterait uniquement le delta de différence.

Pour certain fichier, nous n&rsquo;avons pas eu le choix, nous avons été obliger de fournir une nouvelle version qui remplacerait la version initiale, par exemple les fichiers binaires tels que les images.

Par contre, pour le fichiers XML, et en particulier les fichiers pom.xml ou encore le fichier archetype-metadata.xml, c&rsquo;était plus problématique. En effet, en cas de modification de l&rsquo;un des ces fichiers dans l&rsquo;archetype de base, nous aurions été obligé de copier ceux-ci, et ré-introduire les delta à la main&hellip; ce qui ne serait pas très productifs.

Partant du fait que ces fichiers sont du XML, il me semblait plus logique de partir du fichier de base et de ne décrire que les transformations à lui apporter. Quand on parle de transformation en XML, on pense tout de suite à XSLT.
Mais il faut avouer que s&rsquo;il est très puissant, il n&rsquo;est pas forcément le plus simple à appréhender.

J&rsquo;ai donc cherché des alternatives plus simples. En discutant avec un consultant .Net, celui-ci m&rsquo;a présenté le système qui est utilisé par Microsoft pour gérer les fichiers de configuration de IIS : XML Document Transform.
J&rsquo;ai tout de suite trouvé cette solution élégante pour répondre à notre problème.

Par chance, quelqu&rsquo;un a eu la bonne idée de faire une première implémentation OpenSource ( en se basant sur tout les exemples qu&rsquo;il à trouvé dans la documentation et sur internet.
Son implémentation se basait sur des spécificités .Net, donc impossible de le porter tel quel en Java.
Cependant, son jeu de test était assez complet.

Grâce à celui-ci tests, j&rsquo;ai pu développer en TDD une implémentation en Java : xdt4j." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.gcuisinier.net/blog/2012/03/pr%C3%A9sentation-de-xdt4j/" /><meta property="article:published_time" content="2012-03-15T08:00:00&#43;01:00"/>
<meta property="article:modified_time" content="2012-03-15T08:00:00&#43;01:00"/>


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.7072060d53bb48055d87c305b463893090a2798b2a73a12efc03502e8e2a245d.css" integrity="sha256-cHIGDVO7SAVdh8MFtGOJMJCieYsqc6Eu/ANQLo4qJF0=">


<link rel="stylesheet" href="/scss/print.5aa4005c7565ec5b66c62cd79012c5cad1081f3332793145a8d3861a26391697.css" integrity="sha256-WqQAXHVl7FtmxizXkBLFytEIHzMyeTFFqNOGGiY5Fpc=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container  vertical-center">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.gcuisinier.net">Gildas Cuisinier</a>
      </span>
      <small class="text-center center-block">&lt;dev&gt;SomeWhere&lt;ops&gt;</small>
      
      
        
        
        
        <div class="author-image">
          <img src="https://www.gcuisinier.net/img/gcuisinier.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Gildas Cuisinier</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/posts/">
						<span>Blog</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/portfolio/">
						<span>Projects</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/gcuisinier" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/gcuisinier" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	<a href="https://keybase.io/gcuisinier" rel="me"><i class="fab fa-keybase fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://about.me/gcuisinier"><i class="fas fa-address-card fa-lg" aria-hidden="true"></i></a>
	
	
	&nbsp;<a href="https://hub.docker.com/u/gcuisinier"><i class="fab fa-docker fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="mailto:contact%20[at]%20gcuisinier.net" rel="me"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    

<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>Présentation de xdt4j</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Mar 15, 2012
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/java">JAVA</a>
              •
          
              <a class="badge badge-category" href="/categories/opensource">OPENSOURCE</a>
              •
          
              <a class="badge badge-category" href="/categories/xml">XML</a>
              
          
      
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 4 min read
</div>


  </header>
  
  
  <div class="post">
    <h2 id="introduction">Introduction</h2>

<p>Chez mon client, nous avons eu un besoin particulier : celui de pouvoir étendre des archetypes Maven.
Autrement dit, pouvoir créer un archetype qui se baserait sur un autre, et qui apporterait uniquement le delta de différence.</p>

<p>Pour certain fichier, nous n&rsquo;avons pas eu le choix, nous avons été obliger de fournir une nouvelle version qui remplacerait la version initiale, par exemple les fichiers binaires tels que les images.</p>

<p>Par contre, pour le fichiers XML, et en particulier les fichiers pom.xml ou encore le fichier archetype-metadata.xml, c&rsquo;était plus problématique. En effet, en cas de modification de l&rsquo;un des ces fichiers dans l&rsquo;archetype de base, nous aurions été obligé de copier ceux-ci, et ré-introduire les delta à la main&hellip; ce qui ne serait pas très productifs.</p>

<p>Partant du fait que ces fichiers sont du XML, il me semblait plus logique de partir du fichier de base et de ne décrire que les transformations à lui apporter. Quand on parle de transformation en XML, on pense tout de suite à XSLT.
Mais il faut avouer que s&rsquo;il est très puissant, il n&rsquo;est pas forcément le plus simple à appréhender.</p>

<p>J&rsquo;ai donc cherché des alternatives plus simples. En discutant avec un consultant .Net, celui-ci m&rsquo;a présenté le système qui est utilisé par Microsoft pour gérer les fichiers de configuration de IIS : XML Document Transform.
J&rsquo;ai tout de suite trouvé cette solution élégante pour répondre à notre problème.</p>

<p>Par chance, quelqu&rsquo;un a eu la bonne idée de faire une première implémentation OpenSource (<a href="http://code.google.com/p/xdt/" title="XDT sur GoogleCode" target="_blank"></a> en se basant sur tout les exemples qu&rsquo;il à trouvé dans la documentation et sur internet.
Son implémentation se basait sur des spécificités .Net, donc impossible de le porter tel quel en Java.
Cependant, son jeu de test était assez complet.</p>

<p>Grâce à celui-ci tests, j&rsquo;ai pu développer en TDD une implémentation en Java : <a href="https://github.com/hikage/xdt4j" target="_blank">xdt4j</a>.</p>

<h2 id="utilisation">Utilisation</h2>

<p>Le fonctionnement de XDT pour ajouter/modifier/supprimer des éléments dans un fichier XML est en réalité assez simple.
Le document XML décrivant les transformations est en réalité un document XML qui se conforme à la structure du document de base, mais sur lequel des attributs XDT ont été ajoutés pour décrire la modification voulue.</p>

<p>Prenons par exemple un fichier pom.xml qui servira de base :</p>

<pre><code class="language-xml">&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;be.hikage&lt;/groupId&gt;
    &lt;artifactId&gt;xdt4j&lt;/artifactId&gt;
    &lt;version&gt;1.0.1-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;log4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j&lt;/artifactId&gt;
            &lt;version&gt;1.2.16&lt;/version&gt;
            &lt;packaging&gt;bundle&lt;/packaging&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</code></pre>

<p>La première modification que l&rsquo;on souhaite apporter : Modifier le nom de l&rsquo;artefact.
Pour cela, il suffit de créer un fichier XML ayant une structure identique, qui représentera la modification que l&rsquo;on souhaite apporter.</p>

<p>Ici par exemple :</p>

<pre><code class="language-xml">/tmp/temp_textmate.JcbHjN:2: warning: variable $KCODE is no longer effective; ignored
&lt;project xmlns:xdt=&quot;http://schemas.microsoft.com/XML-Document-Transform&quot;&gt;
    &lt;artifactId xdt:Transform=&quot;Replace&quot;&gt;xdt4j-children&lt;/artifactId&gt;
&lt;/project&gt;
</code></pre>

<p>Vous pouvez voir que pour exprimer les modifications, il suffit d&rsquo;ajouter un attribut de type <code>xdt:Transform</code>.
Ici la valeur &ldquo;Replace&rdquo; signifie que l&rsquo;on souhaite simplement remplacer l&rsquo;élement du document de base par celui-ci.</p>

<p>Une fois les deux documents XML prêts, l&rsquo;API Java de xdt4j est des plus simple :</p>

<pre><code class="language-java">// Chargement des fichiers XML sous forme de Document dom4j
Document xmlBase = loadDocument(&amp;quot;base.xml&amp;quot;);
Document xmlTransform = loadDocument(&amp;quot;transform.xml&amp;quot;);

// Utilisation de xdt4j
XdtTransformer transformer = new XdtTransformer();
Document xmlResult = transformer.transform(xmlBase, xmlTransform);
</code></pre>

<p>Le résultat de la méthode XdtTransformer.transform() est une copie du document original, sur lequel les transformations ont été traités. Le document original n&rsquo;est pas modifié.</p>

<h2 id="transformations-et-locators">Transformations et Locators</h2>

<p>D&rsquo;autres transformations existent.
Avec la transformation &ldquo;Insert&rdquo;, il serait possible d&rsquo;ajouter une dépendance de cette manière:</p>

<pre><code class="language-xml">&lt;project xmlns:xdt=&quot;http://schemas.microsoft.com/XML-Document-Transform&quot;&gt;
    &lt;dependencies&gt;
        &lt;dependency xdt:Transform=&quot;Insert&quot;&gt;
            &lt;groupId&gt;log4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j&lt;/artifactId&gt;
            &lt;version&gt;1.2.16&lt;/version&gt;
            &lt;packaging&gt;bundle&lt;/packaging&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>

<p>Il est également possible de supprimer des élements avec la transformation &ldquo;Remove&rdquo;.
Pour supprimer la dépendance sur log4j par exemple :</p>

<pre><code class="language-xml">&lt;project xmlns:xdt=&quot;http://schemas.microsoft.com/XML-Document-Transform&quot;&gt;
    &lt;dependencies&gt;
        &lt;dependency xdt:Transform=&quot;Remove&quot; xdt:Locator=&quot;Condition(groupId/text()='log4j')&quot;&gt;       
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>

<p>Vous remarquerez dans ce dernier exemple l&rsquo;attribut xdt:Locator. Celui-ci permet de spécifier plus précisement sur quel élement l&rsquo;on souhaite appliquer la modification.</p>

<p>En effet, la transformation &ldquo;Remove&rdquo; par défaut va supprimer le premier élément du document de base qui va correspondre à l&rsquo;expression XPath de l&rsquo;élement sur lequel la transformation est placée.
L&rsquo;attribut Locator permet d&rsquo;effectuer un filtre plus précis via les valeurs possibles <b>Condition</b>, <b>Match</b> ou <b>XPath</b>.</p>

<p>Dans ce cas-ci, <b>Condition</b> prends comme paramètre une condition XPath relative à l&rsquo;élement courant.</p>

<h3>Conclusion</h3>

<p>Dans notre cas, xdt4j est une excellente réponse à notre besoin : l&rsquo;extension d&rsquo;archetype.</p>

<p>Il n&rsquo;est pas forcément complet pour tout les cas de figures, mais il est ouvert et disponible sur GitHub : <a href="https://github.com/hikage/xdt4j">https://github.com/hikage/xdt4j</a>.</p>

<p>Toute participation est donc la bienvenue, que ce soit des patch, des avis, des besoins (ouvrez une issue sur GitHub).</p>

<p>Et bonne nouvelle, les releases de xdt4j sont disponible sur Maven Central :</p>

<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;be.hikage&lt;/groupId&gt;
  &lt;artifactId&gt;xdt4j&lt;/artifactId&gt;
  &lt;version&gt;1.0.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>Les versions Snapshots de leurs coté sont disponibles sur le répository OpenSource de Sonatype : <a href="https://oss.sonatype.org/">https://oss.sonatype.org/</a></p>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/blog/2011/05/tutoriel-comment-cr%C3%A9er-un-dmg/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Tutoriel : Comment créer un DMG</span>
    </a>
    
    
    <a href="/blog/2012/03/spring-mongodb-en-5-minutes/" class="navigation-next">
      <span class="navigation-tittle">Spring MongoDB en 5 minutes</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha256-16e8f08eb363930ccc9f0e91f33ded7905fed943045a040078196294db8a9b17" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
